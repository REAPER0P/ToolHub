<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Image Cropper Tool</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"/>

<style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
    body{
        background: radial-gradient(circle at 20% 20%, #2a2a72, #009ffd);
        min-height:100vh;
        display:flex;
        justify-content:center;
        align-items:center;
        padding:20px;
        color:#fff;
    }
    .container{
        width:100%;
        max-width:520px;
        background:rgba(255,255,255,0.10);
        backdrop-filter:blur(20px);
        padding:25px;
        border-radius:22px;
        box-shadow:0 0 25px rgba(0,0,0,0.4);
    }
    h1{
        text-align:center;
        font-size:1.9rem;
        margin-bottom:15px;
        background:linear-gradient(45deg,#fff,#d4ffec);
        -webkit-background-clip:text;
        -webkit-text-fill-color:transparent;
    }
    button, select{
        width:100%;
        padding:12px;
        border:none;
        border-radius:12px;
        margin:10px 0;
        font-size:1rem;
        font-weight:600;
        cursor:pointer;
    }
    button{
        background:linear-gradient(45deg,#00e0ff,#4be1ec);
    }
    select{
        background:rgba(255,255,255,0.25);
        color:white;
    }
    #imgBox{
        width:100%;
        max-height:350px;
        margin-top:10px;
        background:#000;
        border-radius:15px;
        overflow:hidden;
    }
    img{
        width:100%;
        display:block;
        max-height:350px;
    }
</style>
</head>

<body>
<div class="container">
    <h1>Advanced Image Cropper</h1>

    <input id="upload" type="file" accept="image/*" style="display:none;">
    <button onclick="document.getElementById('upload').click()">üì§ Upload Image</button>

    <select id="ratio">
        <option value="free">Free Crop</option>
        <option value="1">1:1 Square</option>
        <option value="16/9">16:9</option>
        <option value="4/3">4:3</option>
        <option value="3/2">3:2</option>
        <option value="circle">Circle Crop</option>
    </select>

    <button onclick="zoomIn()">üîç Zoom In</button>
    <button onclick="zoomOut()">üîç Zoom Out</button>

    <div id="imgBox">
        <img id="preview">
    </div>

    <button onclick="downloadCrop()">Download Cropped Image</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

<script>
let cropper, isCircle = false;
const upload = document.getElementById("upload");
const preview = document.getElementById("preview");

upload.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    preview.src = URL.createObjectURL(file);

    if (cropper) cropper.destroy();

    preview.onload = () => {
        cropper = new Cropper(preview, {
            viewMode: 1,
            dragMode: "move",
            responsive: true,
            background: false,
            movable: true,
            zoomable: true
        });
    };
});

document.getElementById("ratio").addEventListener("change", e => {
    if (!cropper) return;

    const val = e.target.value;

    if (val === "circle") {
        isCircle = true;
        cropper.setAspectRatio(1);
    } 
    else if (val === "free") {
        isCircle = false;
        cropper.setAspectRatio(NaN);
    }
    else {
        isCircle = false;
        cropper.setAspectRatio(eval(val));
    }
});

function zoomIn(){ if(cropper) cropper.zoom(0.1); }
function zoomOut(){ if(cropper) cropper.zoom(-0.1); }

function downloadCrop(){
    if (!cropper) return alert("Upload image first!");

    const squareCanvas = cropper.getCroppedCanvas();

    if (!isCircle) {
        squareCanvas.toBlob(blob => {
            let link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "cropped-image.png";
            link.click();
        });
        return;
    }

    // Circle crop fix
    const size = Math.min(squareCanvas.width, squareCanvas.height);
    const circleCanvas = document.createElement("canvas");
    const ctx = circleCanvas.getContext("2d");

    circleCanvas.width = size;
    circleCanvas.height = size;

    ctx.beginPath();
    ctx.arc(size/2, size/2, size/2, 0, Math.PI * 2);
    ctx.closePath();
    ctx.clip();

    ctx.drawImage(squareCanvas, 0, 0, size, size);

    circleCanvas.toBlob(blob => {
        let link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "circle-crop.png";
        link.click();
    });
}
</script>
</body>
</html>
